<h1 id="vamianalyzer">VaMiAnalyzer</h1>
<h2 id="overview">Overview</h2>
<p>This project consists of two Python programs that together perform
image correction and tubular structures analysis on <code>.tif</code>
format images. The <code>correct.py</code> program corrects the images
by performing flat-field correction and optionally enhancing local
contrast. The <code>analyze.py</code> program analyzes the corrected
images to identify and process tubular structures.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Python 3.x</li>
<li>OpenCV</li>
<li>NumPy</li>
<li>BaSiC (Basicpy)</li>
<li>Matplotlib</li>
<li>Scikit-image</li>
<li>NetworkX</li>
<li>TQDM</li>
</ul>
<h2 id="installation">Installation</h2>
<p>To run this program, you need to install the required libraries. You
can install them using <code>pip</code>:</p>
<pre><code>pip install opencv-python numpy basicpy matplotlib scikit-image networkx tqdm</code></pre>
<h2 id="step-1---image-shadow-correction">Step 1 - Image Shadow
Correction</h2>
<p>This program uses <a
href="https://github.com/marrlab/BaSiC">BaSic</a> for Background and
Shading Correction. This step is for generating good quality images for
the image analysis program to process in the next step.</p>
<h3 id="parameters">Parameters</h3>
<ul>
<li><code>input_folder</code>: Path to the folder containing the input
images.</li>
<li><code>output_folder</code>: Path to the folder where the corrected
images and summary file will be saved.</li>
<li><code>contrast_balance</code> (optional): Boolean indicating whether
to apply local contrast enhancement (default is
<code>False</code>).</li>
<li><code>clip_limit</code> (optional): Threshold for contrast limiting
if local contrast enhancement is applied (default is
<code>2</code>).</li>
<li><code>tile_grid_size</code> (optional): Size of the grid for the
histogram equalization if local contrast enhancement is applied (default
is <code>8</code>).</li>
</ul>
<h3 id="usage">Usage</h3>
<ol type="1">
<li>Ensure that your input folder contains the <code>.tif</code> images
you want to process.</li>
<li>Specify the paths for the <code>input_folder</code> and
<code>output_folder</code> in the script.</li>
<li>(optional) This program also provides a contrast_balance method for
contrast enhencement. This function is helpful if the images has low
local contrast. To apply this method, set <code>contrast_balance</code>
parameter to <code>True</code> and/or set <code>clip_limit</code> and
<code>tile_grid_size</code> value.</li>
<li>Run the script:</li>
</ol>
<pre><code>python correct.py</code></pre>
<h3 id="output">Output</h3>
<p>The corrected images will be saved in the specified output folder
with the prefix <code>corrected_</code> followed by the original
filename. A summary file named <code>summary.txt</code> will also be
created in the output folder containing the mean and standard deviation
of each corrected image.</p>
<h2 id="step-2---tubular-structures-analysis">Step 2 - Tubular
Structures Analysis</h2>
<p>This part takes the corrected image from step 1 as its input and
analyzes the tubular structures in the images.</p>
<h3 id="parameters-1">Parameters</h3>
<ul>
<li><code>input_path</code>: Path to the input folder or file containing
the images.</li>
<li><code>output_dir</code>: Path to the folder where the results will
be saved.</li>
<li><code>mean</code>: Target mean for image adjustment. After step 1,
you may check the corrected images and the summary file. The mean value
from an image with good quality could be used as the initial value for
this parameter.</li>
<li><code>std</code>: Target standard deviation for image adjustment.
After step 1, you may check the corrected images and the summary file.
The std value from an image with good quality could be used as the
initial value for this parameter.</li>
<li><code>window_size</code>: Size of the window for binary image
creation. A larger window will recognize the texture based on a larger
scale.</li>
<li><code>step_size</code>: Step size for sliding window in binary image
creation. Smaller than window size.</li>
<li><code>merge_threshold</code>: Threshold for merging close nodes in
the graph. The greater this value, the more distant the nodes that will
be merged.</li>
<li><code>min_tubular_length</code>: Minimum length of tubular
structures to be considered for counting the number of tubes.</li>
<li><code>min_end_tubular_length</code>: Minimum length of end tubular
structures for pruning.</li>
<li><code>area_threshold</code>: Minimum area for regions to be
considered in binary image. Regions with an area less than this value
will not be considered a valid structure.</li>
<li><code>std_threshold</code>: Standard deviation threshold for binary
image creation.</li>
<li><code>radius</code>: Radius for local region processing in small
branch removal. If a node is in the middle of a structure with a radius
larger than or equal to this value, the leaf nodes connect to it and
their corresponding tubes will be removed.</li>
<li><code>margin</code>: Margin to be excluded from binary image
creation.</li>
</ul>
<h3 id="usage-1">Usage</h3>
<ol type="1">
<li>Ensure that your input path contains the <code>.tif</code> corrected
images you want to process or specify a single <code>.tif</code> image
file.</li>
<li>Specify the paths for the <code>input_path</code> and
<code>output_dir</code> in the script.</li>
<li>Run the script:</li>
</ol>
<pre><code>python analyze.py</code></pre>
<h3 id="output-1">Output</h3>
<p>The processed images with annotated results and statistics will be
saved in the specified output folder. The number of loops, branch
points, and tubes will be printed out.</p>
